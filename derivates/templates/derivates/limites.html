  {% extends "home.html" %}
  {% load static %}
  {% block content %}
  <section class="limites-container">

  <h1>üìò Derivadas Usando L√≠mites</h1>

  <p class="intro-limites">
    Aunque existen reglas r√°pidas para derivar, la forma m√°s importante y fundamental es
    la definici√≥n mediante l√≠mites.  
    Esta idea nos permite obtener el cambio <b>instant√°neo</b> de una funci√≥n.
  </p>

  <!-- DEFINICI√ìN FORMAL -->
  <div class="definition-box">
    <h3>üìå Definici√≥n formal</h3>
    <p>La derivada de una funci√≥n \( f(x) \) se define como:</p>

    <div class="formula-big">
      $$ f'(x) = \lim_{h \to 0} \frac{f(x+h) - f(x)}{h} $$
    </div>

    <p class="explain-text">
      Esta expresi√≥n calcula la pendiente de la recta secante entre dos puntos.
      Cuando \( h \) se vuelve muy peque√±o, la secante se convierte en la <b>recta tangente</b>,
      es decir, la pendiente exacta en un punto.
    </p>
  </div>

  <h2>Vista desde un gr√°fico</h2>
  <p>Elige una funci√≥n y mueve el control de \( h \) para ver c√≥mo la secante se vuelve tangente.</p>

  <select id="funcSelector" style="padding:6px; margin-bottom:10px;">
      <option value="x2">f(x) = x¬≤</option>
      <option value="x3">f(x) = x¬≥</option>
      <option value="exp">f(x) = eÀ£</option>
      <option value="ln">f(x) = ln(x)</option>
      <option value="sin">f(x) = sin(x)</option>
  </select>

  <canvas id="canvasDerivada" width="500" height="350" style="border:1px solid #ccc"></canvas>

  <div style="margin-top:15px;">
    <label><b>Valor de h:</b> <span id="hValue">1</span></label>
    <input type="range" id="sliderH" min="0.1" max="2" step="0.1" value="1" style="width:300px;">
  </div>

  <p><b>Pendiente aproximada:</b> <span id="pendiente"></span></p>

  <script>
  const canvas = document.getElementById("canvasDerivada");
  const ctx = canvas.getContext("2d");

  // FUNCIONES DISPONIBLES
  function f(x, type) {
      if (type === "x2") return x*x;
      if (type === "x3") return x*x*x;
      if (type === "exp") return Math.exp(x);
      if (type === "ln") return Math.log(x);
      if (type === "sin") return Math.sin(x);
  }

  let tipoFuncion = "x2";
  const x0 = 2;

  const slider = document.getElementById("sliderH");
  const hValue = document.getElementById("hValue");
  const pendienteTxt = document.getElementById("pendiente");
  const funcSelector = document.getElementById("funcSelector");

  function dibujar(h, tipo) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Ejes
      ctx.beginPath();
      ctx.strokeStyle = "#777";
      ctx.moveTo(50, 300);
      ctx.lineTo(450, 300);
      ctx.moveTo(50, 300);
      ctx.lineTo(50, 50);
      ctx.stroke();

      // Curva
      ctx.beginPath();
      ctx.strokeStyle = "#1867c0";
      for (let x = 0.3; x <= 5; x+=0.05) {
          let px = 50 + x*60;
          let py = 300 - f(x, tipo)*40;
          if (x === 0.3) ctx.moveTo(px, py);
          else ctx.lineTo(px, py);
      }
      ctx.stroke();

      let x1 = x0 + h;
      let y0 = f(x0, tipo);
      let y1 = f(x1, tipo);

      let px0 = 50 + x0*60;
      let py0 = 300 - y0*40;
      let px1 = 50 + x1*60;
      let py1 = 300 - y1*40;

      // Secante
      ctx.beginPath();
      ctx.strokeStyle = "#e63946";
      ctx.moveTo(px0, py0);
      ctx.lineTo(px1, py1);
      ctx.stroke();

      // Pendiente
      let pendiente = (y1 - y0) / h;
      pendienteTxt.innerHTML = pendiente.toFixed(4);
  }

  slider.addEventListener("input", function() {
      let h = parseFloat(slider.value);
      hValue.innerHTML = h;
      dibujar(h, tipoFuncion);
  });

  funcSelector.addEventListener("change", function() {
      tipoFuncion = this.value;
      dibujar(parseFloat(slider.value), tipoFuncion);
  });

  // Inicial
  dibujar(1, tipoFuncion);
  </script>

  <h2 class="section-subtitle">‚úÖ EJEMPLO</h2>

  <div class="example-card">
    <p><b>Funci√≥n:</b> \( f(x) = x^2 \)</p>

    <ol class="steps">
        <li>Aplicamos la definici√≥n:</li>
        $$ f'(x) = \lim_{h \to 0} \frac{(x+h)^2 - x^2}{h} $$

        <li>Desarrollamos el cuadrado:</li>
        $$ (x+h)^2 = x^2 + 2xh + h^2 $$

        <li>Reemplazamos:</li>
        $$ f'(x) = \frac{x^2 + 2xh + h^2 - x^2}{h} $$

        <li>Se cancelan \( x^2 \):</li>
        $$ f'(x) = \frac{2xh + h^2}{h} $$

        <li>Factor com√∫n \( h \):</li>
        $$ f'(x) = \frac{h(2x + h)}{h} $$

        <li>Cancelaci√≥n de \( h \):</li>
        $$ f'(x) = 2x + h $$

        <li>Aplicamos el l√≠mite:</li>
        $$ f'(x) = \lim_{h \to 0} (2x + h) = 2x $$
    </ol>

    <p class="result">
      ‚úÖ <b>Resultado:</b> La derivada de \( x^2 \) es \( f'(x) = 2x \)
    </p>
  </div>

    <!-- INTERPRETACI√ìN REAL -->
  <div class="real-example">
    <h3>Interpretaci√≥n real</h3>
    <p>
      Si \( f(x) \) representa la posici√≥n de un auto,  
      entonces \( f'(x) \) es su <b>velocidad instant√°nea</b>.
    </p>
    <p>
      El cociente
      \( \frac{f(x+h) - f(x)}{h} \) mide la velocidad promedio entre dos puntos,
      pero al hacer \( h \to 0 \) obtenemos la velocidad exacta en un instante.
    </p>
  </div>

  <a class="next-button" href="{% url 'derivates_definidas' %}">
    Siguiente: Reglas de Derivaci√≥n ‚Üí
  </a>

</section>

<style>
.limites-container {
  max-width: 900px;
  margin: 40px auto;
  text-align: center;
  padding: 20px;
}

.limites-container h1 {
  font-size: 2.2em;
  color: #24337a;
  margin-bottom: 20px;
}

.intro-limites {
  font-size: 1.15em;
  color: #555;
  margin-bottom: 25px;
}

.definition-box {
  background: #eef3ff;
  border-left: 4px solid #4b6bff;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 35px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.formula-big {
  font-size: 1.35em;
  margin-top: 10px;
}

.section-subtitle {
  color: #1c2e70;
  font-size: 1.5em;
  margin-top: 30px;
}

.example-card {
  background: #f9f9ff;
  border-radius: 15px;
  padding: 20px;
  text-align: left;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  line-height: 1.5;
}

.steps li {
  margin: 10px 0;
  color: #333;
}

.result {
  margin-top: 20px;
  font-size: 1.1em;
  color: #1c4e91;
  text-align: center;
}

.practice-box {
  background: #fffbea;
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid #ffc400;
  margin: 25px auto;
  max-width: 700px;
  text-align: left;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.hint {
  font-size: 0.9em;
  color: #85660a;
  margin-top: 10px;
}

.real-example {
  background: #fffbea;
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid #ffc400;
  margin-top: 35px;
  max-width: 750px;
  margin-left: auto;
  margin-right: auto;
}

.next-button {
  display: inline-block;
  margin-top: 30px;
  padding: 12px 22px;
  background: #3e5bff;
  color: white;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1.05em;
  text-decoration: none;
}
.next-button:hover {
  background: #1f39c2;
}
</style>

{% endblock %}
